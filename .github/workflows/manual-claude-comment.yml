name: Manual Claude Comment on Issue

on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰'
        required: true
        type: choice
        options:
          - 'list-issues'
          - 'comment-on-issue'
        default: 'list-issues'
      issue_number:
        description: 'Issueç•ªå· (comment-on-issueãƒ¢ãƒ¼ãƒ‰æ™‚ã«æŒ‡å®š)'
        required: false
        type: number
      comment_message:
        description: 'ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¡ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)'
        required: false
        type: string

jobs:
  list-open-issues:
    if: github.event.inputs.mode == 'list-issues'
    runs-on: ubuntu-latest
    permissions:
      issues: read

    steps:
      - name: List all open issues
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            console.log('ğŸ“‹ Open Issues ãƒªã‚¹ãƒˆ\n');

            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              sort: 'created',
              direction: 'desc',
              per_page: 100
            });

            const issueList = issues.data
              .filter(issue => !issue.pull_request)
              .map(issue => {
                return `#${issue.number}: ${issue.title}`;
              });

            if (issueList.length === 0) {
              console.log('Open issueãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
            } else {
              console.log(`å…¨ ${issueList.length} ä»¶ã®open issues:\n`);
              issueList.forEach(item => console.log(item));

              console.log('\n\nğŸ“ ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã«ã¯:');
              console.log('1. ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å†åº¦å®Ÿè¡Œ');
              console.log('2. ãƒ¢ãƒ¼ãƒ‰ã§ "comment-on-issue" ã‚’é¸æŠ');
              console.log('3. Issueç•ªå·ã‚’å…¥åŠ›');
            }

  comment-on-specific-issue:
    if: github.event.inputs.mode == 'comment-on-issue' && github.event.inputs.issue_number != ''
    uses: ./.github/workflows/claude-auto-implement.yml
    with:
      issue_number: ${{ fromJSON(github.event.inputs.issue_number) }}
      comment_message: ${{ github.event.inputs.comment_message != '' && github.event.inputs.comment_message || '@claude pluginã§ä½¿ãˆã‚‹å½¢ã§å®Ÿè£…ã—ã¦ã€‚å®Ÿè£…ãŒçµ‚ã‚ã£ãŸã‚‰`gh pr create`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦PullRequestã‚’mainãƒ–ãƒ©ãƒ³ãƒã«å¯¾ã—ã¦è‡ªå‹•ä½œæˆã—ã¦ã€‚æ‰‹å‹•ãƒªãƒ³ã‚¯ã¯ä¸è¦ã§ã™ã€‚' }}
    secrets:
      PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
